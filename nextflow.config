/*
 * Pipeline Configuration Script
 * -----------------------------
 *
 * This configuration file defines the parameters, container settings, and 
 * environment variables for running a containerized data analysis pipeline.
 *
 * Parameters:
 *  - output_dir (string, default: 'results'):
 *      Directory where final output files will be written.
 *
 *  - upload_to_synapse (boolean, default: false):
 *      If true, results will be uploaded to a Synapse project folder.
 *
 *  - synapse_folder_id (string | null, default: null):
 *      Synapse folder ID to upload results to. Required only if upload_to_synapse is true.
 *
 *  - use_gpt (boolean, default: true):
 *      Enables GPT-based analysis. If false, the pipeline will run static-only analysis.
 *      A warning will be issued if no OpenAI API key is provided when this is true.
 *
 * Process Containers:
 *  - ProcessRepo:
 *      Uses 'bitnami/git:2.44.0' container to manage repository-related tasks.
 *
 *  - GenerateReport:
 *      Uses 'ubuntu:22.04' container to generate output reports.
 *
 * Work Directory:
 *  - All intermediate files are stored in the 'work' directory.
 *
 * Docker:
 *  - Docker is enabled to ensure process-level isolation and reproducibility.
 *
 * Environment Variables:
 *  - OPENAI_API_KEY:
 *      Retrieved from the system environment. Required if use_gpt is enabled.
 */


params {
    output_dir = 'results'
    upload_to_synapse = false
    synapse_folder_id = null
    // GPT analysis is optional - if false, will use static analysis only
    use_gpt = true  // Set to true for this branch to test gpt functionality, a warning is issued if OpenAI API Key is not provided.
}

process {
    withName: ProcessRepo {
        container = 'bitnami/git:2.44.0'
    }
    
    withName: GenerateReport {
        container = 'ubuntu:22.04'
    }
}

workDir = 'work'

docker {
    enabled = true
}

// OpenAI API key is only needed if use_gpt=true
env {
    OPENAI_API_KEY = System.getenv('OPENAI_API_KEY')
}
